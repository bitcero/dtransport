var RMMSG_INFO=0,RMMSG_WARN=1,RMMSG_SUCCESS=2,RMMSG_SAVED=3,RMMSG_ERROR=4,RMMSG_OTHER=5,pni="";!function(e){function n(i){setTimeout(function(){e("#down-loader").fadeOut(400,function(){e("#down-blocker").fadeOut(200)})},1e3*i)}function a(i,n){e("#down-loader span").fadeOut(100,function(){e(this).html(i),e(this).removeClass(),""!=n&&e(this).addClass(n),e(this).fadeIn(100)})}function t(){e("#frm-items");var n=e("#frm-items [required]"),a=!1;for(i=0;i<n.length;i++)""==e(n[i]).val()&&(e("label[for='"+e(n[i]).attr("id")+"']").addClass("error_field"),a=!0);return!a&&((n=e("ul.dt-categories :checked")).length<=0?(e("label.dt_lcats").addClass("error_field"),!1):(n=e("ul.dt-licenses :checked")).length<=0?(e("label.dt_llics").addClass("error_field"),!1):(n=e("ul.dt-platforms :checked")).length<=0?(e("label.dt_lplats").addClass("error_field"),!1):!((n=e("ul.groups_field_list :checked")).length<=0)||(e("label.dt_lgroups").addClass("error_field"),!1))}e(document).ready(function(){e("#frm-items #name").keyup(function(){""!=e(this).val()?e("#down-commands").is(":visible")||e("#down-commands").fadeIn("fast"):e("#down-commands").is(":visible")&&e("#down-commands").fadeOut("fast")}),e("#frm-items #name").change(function(){e("#frm-items #name").keyup()}),e("#cancel-data").click(function(){return document.location.href="items.php",!1}),e("#save-data").click(function(){var i=e("#down-loader span");return i.removeClass(),e("#down-blocker").fadeIn(200,function(){i.html(jsLang.checkForm),e("#down-loader").fadeIn(700,function(){if(!t())return a(jsLang.errForm,DT_ERROR),n(4),!1;a(jsLang.okForm,DT_OK),"undefined"!=typeof tinymce?tinymce.activeEditor.save():"undefined"!=typeof mdEditor&&mdEditor.save("desc");var i=e("#frm-items").serialize();return e.post(DT_URL+"/ajax/items-ajax.php",i,function(i){a(i.message,1==i.error?DT_ERROR:DT_OK),""!=i.token?(e("#XOOPS_TOKEN_REQUEST").val(i.token),e("#soft-id").val(i.id),e("#item-permalink .permalink").html(i.link),e("#item-permalink").slideDown("fast",function(){e(this).effect("highlight",{},1e3)}),e("#action").val("saveedit"),n(2)):window.location.reload()},"json"),!1})}),!1}),e("#add-tags").click(function(){if(""==e("#tags").val())return!1;var n=e("#tags").val().split(","),a="",t=[],l=e("#tags-container span.tag");for(i=0;i<l.length;i++)t[i]=e(l[i]).html();for(i=0;i<n.length;i++)a=n[i].replace(/^\s+|\s+$/g,""),jQuery.inArray(a,t)>=0||e("#tags-container").append('<span class="tag">'+a+'</span><input type="hidden" name="tags[]" value="'+a+'" />');e("#tags").val("").focus()}),e("#tags").keyup(function(i){13==i.which&&e("#add-tags").click()}),e("#item-permalink .permalink span em").on("click",function(){if(!(e(this).children("input").length>0)){pni=e(this).html();var i='<input type="text" name="nameid" size="5" id="nameid" value="'+e(this).html()+'" />';i+='<span rel="ok"></span><span rel="cancel"></span>',e(this).html(""),e("#item-permalink .permalink span").addClass("editing"),e("#item-permalink .permalink span").append(i),e("#item-permalink .permalink span.editing span").on("click",function(){if("cancel"==e(this).attr("rel"))return e("#item-permalink .permalink span input").remove(),e("#item-permalink .permalink span span").remove(),e("#item-permalink .permalink span em").html(pni),void e("#item-permalink .permalink span").removeClass("editing");var i={id:e("#soft-id").val(),nameid:e("#item-permalink .permalink span input").val(),XOOPS_TOKEN_REQUEST:e("#XOOPS_TOKEN_REQUEST").val(),action:"permaname"};e.post(DT_URL+"/ajax/items-ajax.php",i,function(i){if(1==i.error)return alert(i.message),""==i.token?void window.location.reload():void e("#XOOPS_TOKEN_REQUEST").val(i.token);e("#item-permalink .permalink span input").remove(),e("#item-permalink .permalink span span").remove(),e("#item-permalink .permalink span em").html(i.nameid),e("#item-permalink .permalink span").removeClass("editing")},"json")})}}),e("#tags-container").on("click","span.tag",function(){e(this).remove()})})}(jQuery),function(e){var i,n;this.DownloadsApp=function(){this.init=function(){i=this,n=e("#frm-items"),e("#publish-data").click(function(){i.publish()}),e("#save-data").click(function(){i.save()}),e("#verify-data").click(function(){i.verify()})},this.publish=function(){e("#action").val("publish"),e(n).validate(),e(n).submit()},this.save=function(){e("#action").val("save"),e(n).validate(),e(n).submit()},this.verify=function(){e("#action").val("verify"),e(n).validate(),e(n).submit()}},(new DownloadsApp).init()}(jQuery);